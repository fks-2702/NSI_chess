<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <title></title>
        <meta charset="UTF-8">
        <style>
            .chess-board { border-spacing: 0; border-collapse: collapse; }
            .chess-board th { padding: .5em; }
            .chess-board th + th { border-bottom: 1px solid #000; }
            .chess-board th:first-child,
            .chess-board td:last-child { border-right: 1px solid #000; }
            .chess-board tr:last-child td { border-bottom: 1px solid; }
            .chess-board th:empty { border: none; }
            .chess-board td { width: 1.5em; height: 1.5em; text-align: center; font-size: 32px; line-height: 0;}
            .chess-board .light { background: #eee; }
            .chess-board .dark { background: #aaa; }

        </style>
        <link rel="stylesheet" href="style.css">

    </head>

    <body data-new-gr-c-s-check-loaded="8.912.0" data-gr-ext-installed="">
		
        <div class="topnav">
            <a href="./home.html">Home</a>
            <a class="active" href="./game.html">Games</a>
            <a href="./pieces.html">Pieces</a>
            <a href="./rules.html">Rules</a>
        </div> 
        
        <button onclick="updateBoard()">update board</button>
        <div style="align-self: center;">
        <table class="chess-board" style="border: #000 ; border-style: solid;">
            <tbody>
                <tr class="letters">
                    <th></th>
                    <th>a</th>
                    <th>b</th>
                    <th>c</th>
                    <th>d</th>
                    <th>e</th>
                    <th>f</th>
                    <th>g</th>
                    <th>h</th>
                </tr>
                <tr class="row row8">
                    <th class="number number8">8</th>
                    <td class="light">♜</td>
                    <td class="dark">♞</td>
                    <td class="light">♝</td>
                    <td class="dark">♛</td>
                    <td class="light">♚</td>
                    <td class="dark">♝</td>
                    <td class="light">♞</td>
                    <td class="dark">♜</td>
					<th class="number number8">8</th>
                </tr>
                <tr class="row row7">
                    <th class="number number7">7</th>
                    <td class="dark">♟</td>
                    <td class="light">♟</td>
                    <td class="dark">♟</td>
                    <td class="light">♟</td>
                    <td class="dark">♟</td>
                    <td class="light">♟</td>
                    <td class="dark">♟</td>
                    <td class="light">♟</td>
					<th class="number number7">7</th>
                </tr>
                <tr class="row row6">
                    <th class="number number6">6</th>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
					<th class="number number6">6</th>
                </tr>
                <tr class="row row5">
                    <th class="number number5">5</th>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
					<th class="number number5">5</th>
                </tr>
                <tr class="row row4">
                    <th class="number number4">4</th>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
					<th class="number number4">4</th>
                </tr>
                <tr class="row row3">
                    <th class="number number3">3</th>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
                    <td class="dark"></td>
                    <td class="light"></td>
					<th class="number number3">3</th>
                </tr>
                <tr class="row row2">
                    <th class="number number2">2</th>
                    <td class="light">♙</td>
                    <td class="dark">♙</td>
                    <td class="light">♙</td>
                    <td class="dark">♙</td>
                    <td class="light">♙</td>
                    <td class="dark">♙</td>
                    <td class="light">♙</td>
                    <td class="dark">♙</td>
					<th class="number number2">2</th>
                </tr>
                <tr class="row row1">
                    <th class="number number1">1</th>
                    <td class="dark">♖</td>
                    <td class="light">♘</td>
                    <td class="dark">♗</td>
                    <td class="light">♕</td>
                    <td class="dark">♔</td>
                    <td class="light">♗</td>
                    <td class="dark">♘</td>
                    <td class="light">♖</td>
					<th class="number number1">1</th>
                </tr>
				<tr class="letters">
                    <th></th>
                    <th>a</th>
                    <th>b</th>
                    <th>c</th>
                    <th>d</th>
                    <th>e</th>
                    <th>f</th>
                    <th>g</th>
                    <th>h</th>
                </tr>
            </tbody>
        </table>
    </div>
		<br>

		<div class="info">
			<p class="side_to_play">Side to play: White</p>
		</div>


		<script>
			let pieceToSymbol = {
				"r": "♜", "n": "♞", "b": "♝", "q": "♛", "k": "♚", "p": "♟",
				"R": "♖", "N": "♘", "B": "♗", "Q": "♕", "K": "♔", "P": "♙"
			};
			
			let rows = [
				["r", "n", "b", "q", "k", "b", "n", "r"],
				["p", "p", "p", "p", "p", "p", "p", "p"],
				["", "", "", "", "", "", "", ""],
				["", "", "", "", "", "", "", ""],
				["", "", "", "", "", "", "", ""],
				["", "", "", "", "", "", "", ""],
				["P", "P", "P", "P", "P", "P", "P", "P"],
				["R", "N", "B", "Q", "K", "B", "N", "R"]
			];
			
			var side_to_play = "White";
			
			var initialCell = "";
			var finalCell = "";
			
			
			var callServer = function(request, callback) {
				const options = {
					method: 'POST',
					body: JSON.stringify(request),
					headers: {
						'Content-Type': 'application/json',
					}
				};
			
				fetch('http://mylinux.lfny.org:30035', options)
				.then(function(res) { return res.text(); })
				.then(function(text) { callback(null, text); })
				.catch(function(err) { callback(err, null); });
			};
			
			var client = (method, args, callback) => {
				callServer({ jsonrpc: '2.0', method: method, params: args, id: 1 }, callback);
			}
			document.querySelector('.chess-board').addEventListener('click', function(e) {
				var cell = e.target;
				if (cell.tagName === 'TD') {
					var col = cell.cellIndex;
					var row = cell.parentNode.rowIndex;
					let c = (String.fromCharCode(97 + col - 1) + (8 - row + 1));
					cell.style.backgroundColor = 'yellow';
					if (initialCell === "") {
						initialCell = c;
					} else {
						if (initialCell === c) {
							initialCell = "";
							cell.style.backgroundColor = '';
							return;
						}
						finalCell = c;
						console.log(initialCell, finalCell);

						document.querySelectorAll('.chess-board tr.row td').forEach((e) => e.removeAttribute("style"));
						
						// call rpc for move 
						client('move', ["123", initialCell, finalCell], function(err, result) {
							if(err) throw err;
							console.table(result);
						});

						initialCell = "";
						finalCell = "";
						
						updateBoard()
					}
				}
				
				
			});
			
			function updateBoard () {

				client('getGameState', ["123"], function(err, result) {
					if(err) throw err;
					console.table(JSON.parse(result));
					let r = JSON.parse(result).result.game.board.configuration.pieces;
					
					for (let i = 0; i < 8; i++) {
						for (let j = 0; j < 8; j++) {
							let cell = document.querySelector('.chess-board').rows[i].cells[j];
							let c = (String.fromCharCode(97 + j - 33) + (8 - i + 1));

							cell.textContent = pieceToSymbol[r[c]];
						}
					}

					document.querySelectorAll('.chess-board tr.letters').forEach((e) => {
						e.innerHTML = "<th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th><th>f</th><th>g</th><th>h</th>";
					});

					document.querySelectorAll('.chess-board tr.row th.number').forEach((e) => {
						e.textContent = e.classList[1].slice(-1);
					});

					document.querySelector('.side_to_play').textContent = "Side to play: " + JSON.parse(result).result.game.board.configuration.turn;
				})

			}


		</script>
    

</body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>